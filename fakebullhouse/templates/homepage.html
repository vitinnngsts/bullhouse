<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>CARD√ÅPIO BULL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    background-image: url("{{ url_for('static', filename='fundo/fundo.png') }}");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    min-height: 100vh;
    margin: 0;
    font-family: Arial, sans-serif;
    color: white;
}

/* ===== CENTRAL ===== */
.central {
    text-align: center;
    background: rgba(0,0,0,0.65);
    padding: 30px;
    border-radius: 20px;
    max-width: 90%;
    margin: 40px auto;
}

h1 {
    font-size: clamp(40px, 8vw, 100px);
    margin-bottom: 10px;
}

button {
    padding: 12px 20px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
    cursor: pointer;
}

/* ===== MODAIS ===== */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    z-index: 100;
    overflow-y: auto;
}

.modal-content {
    background: #111;
    max-width: 1200px;
    margin: 40px auto;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
}

.close {
    font-size: 30px;
    float: right;
    cursor: pointer;
}

/* ===== GRID ===== */
.grid {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
}

/* ===== CARD ===== */
.card {
    background: #222;
    padding: 15px;
    border-radius: 15px;
    width: 280px;
    cursor: pointer;
}

.card img {
    width: 100%;
    border-radius: 10px;
}

/* ===== CARRINHO FIXO ===== */
.carrinho-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: red;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    font-size: 26px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
}

.badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: black;
    color: white;
    font-size: 14px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
}

/* ===== MODAL ADD ===== */
#img-produto {
    width: 200px;
    border-radius: 15px;
}

input, textarea {
    width: 90%;
    padding: 10px;
    border-radius: 8px;
    border: none;
}
</style>
</head>

<body>

<div class="central">
    <h1>CARD√ÅPIO BULL</h1>
    <img src="{{ url_for('static', filename='logo/logo.png') }}" width="180"><br><br>

    <button onclick="abrirModal('hamburgueres')">üçî Hamb√∫rgueres</button>
    <button onclick="abrirModal('porcoes')">üçü Por√ß√µes</button>
</div>

<!-- ===== MODAL HAMBURGUER ===== -->
<div id="hamburgueres" class="modal">
<div class="modal-content">
<span class="close" onclick="fecharModal('hamburgueres')">√ó</span>
<h2>üçî Hamb√∫rgueres</h2>

<div class="grid">
{% for p in produtos_hamburguer %}
<div class="card" onclick="abrirProduto({{ p.id }}, '{{ p.nome }}', '{{ p.imagem }}', '{{ p.descricao }}', 'hamburgueres')">
<img src="{{ url_for('static', filename='hamburgueres/' + p.imagem) }}">
<h3>{{ p.nome }}</h3>
<p>{{ p.descricao }}</p>
<strong>R$ {{ p.preco }}</strong>
</div>
{% endfor %}
</div>

</div>
</div>

<!-- ===== MODAL POR√á√ïES (BUG CORRIGIDO AQUI) ===== -->
<div id="porcoes" class="modal">
<div class="modal-content">
<span class="close" onclick="fecharModal('porcoes')">√ó</span>
<h2>üçü Por√ß√µes</h2>

<div class="grid">
{% for p in produtos_porcoes %}
<div class="card" onclick="abrirProduto({{ p.id }}, '{{ p.nome }}', '{{ p.imagem }}', '{{ p.descricao }}', 'porcoes')">
<img src="{{ url_for('static', filename='porcoes/' + p.imagem) }}">
<h3>{{ p.nome }}</h3>
<p>{{ p.descricao }}</p>
<strong>R$ {{ p.preco }}</strong>
</div>
{% endfor %}
</div>

</div>
</div>

<!-- ===== MODAL ADD CARRINHO ===== -->
<div id="modal-carrinho" class="modal">
<div class="modal-content">
<span class="close" onclick="fecharModal('modal-carrinho')">√ó</span>

<img id="img-produto">
<h2 id="nome-produto"></h2>
<p id="desc-produto"></p>

<label>Quantidade</label><br>
<input type="number" id="qtd" value="1"><br><br>

<label>Observa√ß√µes</label><br>
<textarea id="obs"></textarea><br><br>

<button onclick="adicionarCarrinho()">Adicionar ao carrinho</button>
</div>
</div>

<!-- ===== BOT√ÉO CARRINHO ===== -->
<div class="carrinho-btn" onclick="window.location='/checkout'">
üõí
<span class="badge" id="qtd-carrinho">0</span>
</div>

<script>
let produtoAtual = {};

function abrirModal(id){ document.getElementById(id).style.display = "block"; }
function fecharModal(id){ document.getElementById(id).style.display = "none"; }

function abrirProduto(id, nome, img, desc, pasta){
    produtoAtual = { id, nome };
    document.getElementById("nome-produto").innerText = nome;
    document.getElementById("desc-produto").innerText = desc;
    document.getElementById("img-produto").src =
        "{{ url_for('static', filename='') }}" + pasta + "/" + img;
    abrirModal("modal-carrinho");
}

function adicionarCarrinho(){
    fetch("/add_carrinho", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            id: produtoAtual.id,
            nome: produtoAtual.nome,
            quantidade: document.getElementById("qtd").value,
            observacoes: document.getElementById("obs").value
        })
    }).then(()=>{
        fecharModal("modal-carrinho");
        atualizarCarrinho();
    });
}

function atualizarCarrinho(){
    fetch("/get_carrinho")
    .then(r=>r.json())
    .then(c=>{
        let total = c.reduce((s,i)=>s+i.quantidade,0);
        document.getElementById("qtd-carrinho").innerText = total;
    });
}

window.onload = atualizarCarrinho;
</script>

</body>
</html>
